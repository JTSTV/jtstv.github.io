<!DOCTYPE html><html><head><meta charset="utf-8"><title>创建脚本使loophole在使其前台后台同时保持运行，不掉线，断开自动连接 | 悔恨自己的博客</title><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 8.1.1"></head><body> <div id="container"> <div id="wrap"> <header id="header"> <div id="banner"></div> <div id="header-outer" class="outer"> <div id="header-title" class="inner"><a href="/" id="logo"> 悔恨自己的博客</a></div> <div id="header-inner" class="inner"></div> </div></header> <div class="outer"> <section id="main"><article id="post-创建脚本使loophole在使其前台后台同时保持运行，不掉线，断开自动连接" class="article article-type-post h-entry"><div class="article-meta"> <a href="/%E5%88%9B%E5%BB%BA%E8%84%9A%E6%9C%AC%E4%BD%BFloophole%E5%9C%A8%E4%BD%BF%E5%85%B6%E5%89%8D%E5%8F%B0%E5%90%8E%E5%8F%B0%E5%90%8C%E6%97%B6%E4%BF%9D%E6%8C%81%E8%BF%90%E8%A1%8C%EF%BC%8C%E4%B8%8D%E6%8E%89%E7%BA%BF%EF%BC%8C%E6%96%AD%E5%BC%80%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5.htm" class="article-date"> <time class="dt-published" datetime="2026-02-22T13:51:44.000Z" itemprop="datePublished">2026年02月22</time> </a> </div> <div class="article-inner"> <header class="article-header"> <h1 class="article-title p-name" itemprop="headline name"> 创建脚本使loophole在使其前台后台同时保持运行，不掉线，断开自动连接 </h1> </header> <div class="article-entry e-content" itemprop="articleBody"> <figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># /root/run_loophole.sh</span></span><br><span class="line"><span class="comment"># 说明：此脚本用于保持 Loophole 隧道常驻运行，如果掉线自动重连</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 设置环境变量（可选）</span></span><br><span class="line"><span class="comment"># export PATH=/usr/local/bin:$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 定义日志文件路径</span></span><br><span class="line">LOG_FILE=<span class="string">&quot;/root/loophole.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 无限循环，确保掉线自动重连</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 记录重连时间</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;[<span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span>] - Loophole 隧道启动中...&quot;</span> &gt;&gt; <span class="variable">$LOG_FILE</span></span><br><span class="line">            </span><br><span class="line">                <span class="comment"># 4. 启动 Loophole 隧道</span></span><br><span class="line">                    <span class="comment"># 注意：这里的路径请确保正确，通常是 /usr/local/bin/loophole</span></span><br><span class="line">                        /usr/local/bin/loophole http 8000 --hostname hhwzj &gt;&gt; <span class="variable">$LOG_FILE</span> 2&gt;&amp;1</span><br><span class="line">                            </span><br><span class="line">                                <span class="comment"># 5. 当 Loophole 进程退出（掉线）时，记录日志并等待重连</span></span><br><span class="line">                                    <span class="built_in">echo</span> <span class="string">&quot;[<span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span>] - Loophole 隧道掉线，5秒后尝试重连...&quot;</span> &gt;&gt; <span class="variable">$LOG_FILE</span></span><br><span class="line">                                        </span><br><span class="line">                                            <span class="comment"># 等待5秒后重连</span></span><br><span class="line">                                                <span class="built_in">sleep</span> 5</span><br><span class="line">                                                <span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure> <figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /root/run_loophole.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure> <figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> /root/run_loophole.sh &gt; /root/loophole.out 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br></pre></td></tr></table></figure> <hr> <figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查 rc-local.service 是否存在（对于老系统）</span></span><br><span class="line">systemctl status rc-local</span><br><span class="line"><span class="comment"># 如果不存在，可能需要手动创建 rc.local 文件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure> <figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开编辑器</span></span><br><span class="line">vim /etc/rc.local</span><br><span class="line"></span><br></pre></td></tr></table></figure> <figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保脚本可执行</span></span><br><span class="line"><span class="built_in">chmod</span> +x /root/run_loophole.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 nohup 启动</span></span><br><span class="line"><span class="built_in">nohup</span> /root/run_loophole.sh &gt; /root/loophole.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br></pre></td></tr></table></figure> <figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /etc/rc.local</span><br><span class="line"></span><br></pre></td></tr></table></figure> <figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启后查看日志</span></span><br><span class="line"><span class="built_in">cat</span> /root/loophole.log</span><br><span class="line"></span><br></pre></td></tr></table></figure> </div> <footer class="article-footer"> </footer> </div> <nav id="article-nav"> <a href="/%E6%88%91%E7%9A%84%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E4%BA%8C%E7%BB%B4%E7%A0%81.htm" id="article-nav-newer" class="article-nav-link-wrap"> <strong class="article-nav-caption">前一篇</strong> <div class="article-nav-title"> 我的微信收款二维码.谢谢善良好心人士的捐赠 </div> </a> <a href="/%E4%BB%8E%E5%8E%BB%E5%B9%B4%E7%9A%84%E8%BF%99%E5%A4%A9%E5%88%B0%E7%8E%B0%E5%9C%A8%EF%BC%8C%E8%BF%99%E4%B9%88%E5%A4%9A%E4%B8%8D%E5%B9%B8%E5%8F%91%E7%94%9F%E5%9C%A8%E6%88%91%E8%BA%AB%E4%B8%8A%EF%BC%8C%E8%84%9A%E8%B6%BE%E5%A4%B4%E5%8F%97%E4%BC%A4%E5%88%B0%E7%8E%B0%E5%9C%A8%E4%B8%80%E5%B9%B4%E4%BA%86%EF%BC%8C%E5%93%92%E5%93%92%E7%A6%BB%E5%BC%80%E4%BA%86%E6%88%91%EF%BC%8C%E6%88%91%E5%BF%83%E6%8E%89%E5%80%92%E8%B0%B7%E5%BA%95%EF%BC%8C%E5%86%8D%E6%89%BE%E4%B8%8D%E5%88%B0%E6%B4%BB%E4%B8%8B%E5%8E%BB%E7%9A%84%E6%84%8F%E4%B9%89.htm" id="article-nav-older" class="article-nav-link-wrap"> <strong class="article-nav-caption">后一篇</strong> <div class="article-nav-title">从去年的这天到现在，这么多不幸发生在我身上，脚趾头受伤到现在一年了，哒哒离开了我，我心掉倒谷底，再找不到活下去的意义</div> </a> </nav> </article> </section> </div> <footer id="footer"> <a href="https://hexo.io/" target="_blank">Hexo</a></footer> </div> <nav id="mobile-nav"> </nav> </div> </body></html>
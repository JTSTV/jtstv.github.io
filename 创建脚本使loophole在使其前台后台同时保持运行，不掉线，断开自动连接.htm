<!DOCTYPE html><html><head><meta charset="utf-8"><title>创建脚本使loophole在使其前台后台同时保持运行，不掉线，断开自动连接 | 悔恨自己的博客</title><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 8.1.1"></head><body> <div id="container"> <div id="wrap"> <header id="header"> <div id="banner"></div> <div id="header-outer" class="outer"> <div id="header-title" class="inner"><a href="/" id="logo"> 悔恨自己的博客</a></div> <div id="header-inner" class="inner"></div> </div></header> <div class="outer"> <section id="main"><article id="post-创建脚本使loophole在使其前台后台同时保持运行，不掉线，断开自动连接" class="article article-type-post h-entry"><div class="article-meta"> <a href="/%E5%88%9B%E5%BB%BA%E8%84%9A%E6%9C%AC%E4%BD%BFloophole%E5%9C%A8%E4%BD%BF%E5%85%B6%E5%89%8D%E5%8F%B0%E5%90%8E%E5%8F%B0%E5%90%8C%E6%97%B6%E4%BF%9D%E6%8C%81%E8%BF%90%E8%A1%8C%EF%BC%8C%E4%B8%8D%E6%8E%89%E7%BA%BF%EF%BC%8C%E6%96%AD%E5%BC%80%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5.htm" class="article-date"> <time class="dt-published" datetime="2026-02-22T13:51:44.000Z" itemprop="datePublished">2026年02月22</time> </a> </div> <div class="article-inner"> <header class="article-header"> <h1 class="article-title p-name" itemprop="headline name"> 创建脚本使loophole在使其前台后台同时保持运行，不掉线，断开自动连接 </h1> </header> <div class="article-entry e-content" itemprop="articleBody"> <p>完整脚本编写（run_loophole.sh）<br>‘’’<br>#!&#x2F;bin&#x2F;bash</p> <h1 id="root-run-loophole-sh"><a href="#root-run-loophole-sh" class="headerlink" title="&#x2F;root&#x2F;run_loophole.sh"></a>&#x2F;root&#x2F;run_loophole.sh</h1><h1 id="说明：此脚本用于保持-Loophole-隧道常驻运行，如果掉线自动重连"><a href="#说明：此脚本用于保持-Loophole-隧道常驻运行，如果掉线自动重连" class="headerlink" title="说明：此脚本用于保持 Loophole 隧道常驻运行，如果掉线自动重连"></a>说明：此脚本用于保持 Loophole 隧道常驻运行，如果掉线自动重连</h1><h1 id="1-设置环境变量（可选）"><a href="#1-设置环境变量（可选）" class="headerlink" title="1. 设置环境变量（可选）"></a>1. 设置环境变量（可选）</h1><h1 id="export-PATH-usr-local-bin-PATH"><a href="#export-PATH-usr-local-bin-PATH" class="headerlink" title="export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bin:$PATH"></a>export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bin:$PATH</h1><h1 id="2-定义日志文件路径"><a href="#2-定义日志文件路径" class="headerlink" title="2. 定义日志文件路径"></a>2. 定义日志文件路径</h1><p>LOG_FILE&#x3D;”&#x2F;root&#x2F;loophole.log”</p> <h1 id="3-无限循环，确保掉线自动重连"><a href="#3-无限循环，确保掉线自动重连" class="headerlink" title="3. 无限循环，确保掉线自动重连"></a>3. 无限循环，确保掉线自动重连</h1><p>while true; do<br> # 记录重连时间<br> echo “[$(date ‘+%Y-%m-%d %H:%M:%S’)] - Loophole 隧道启动中…” &gt;&gt; $LOG_FILE</p> <pre><code># 4. 启动 Loophole 隧道
# 注意：这里的路径请确保正确，通常是 /usr/local/bin/loophole
/usr/local/bin/loophole http 8000 --hostname hhwzj &gt;&gt; $LOG_FILE 2&gt;&amp;1

# 5. 当 Loophole 进程退出（掉线）时，记录日志并等待重连
echo &quot;[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] - Loophole 隧道掉线，5秒后尝试重连...&quot; &gt;&gt; $LOG_FILE

# 等待5秒后重连
sleep 5
</code></pre> <p>done<br>‘’’<br>‘chmod +x &#x2F;root&#x2F;run_loophole.sh<br>‘<br>rc.local 是最传统、最可靠的方式。</p> <p> 确认系统支持 rc.local<br> ‘’’</p> <h1 id="检查-rc-local-service-是否存在（对于老系统）"><a href="#检查-rc-local-service-是否存在（对于老系统）" class="headerlink" title="检查 rc-local.service 是否存在（对于老系统）"></a>检查 rc-local.service 是否存在（对于老系统）</h1><p> systemctl status rc-local</p> <h1 id="如果不存在，可能需要手动创建-rc-local-文件"><a href="#如果不存在，可能需要手动创建-rc-local-文件" class="headerlink" title="如果不存在，可能需要手动创建 rc.local 文件"></a>如果不存在，可能需要手动创建 rc.local 文件</h1><p> ‘’’<br> 创建或编辑 &#x2F;etc&#x2F;rc.local<br> ‘’’</p> <h1 id="打开编辑器"><a href="#打开编辑器" class="headerlink" title="打开编辑器"></a>打开编辑器</h1><p>vim &#x2F;etc&#x2F;rc.local<br>‘’’<br>‘’’<br>#!&#x2F;bin&#x2F;bash</p> <h1 id="确保脚本可执行"><a href="#确保脚本可执行" class="headerlink" title="确保脚本可执行"></a>确保脚本可执行</h1><p>chmod +x &#x2F;root&#x2F;run_loophole.sh</p> <h1 id="使用-nohup-启动"><a href="#使用-nohup-启动" class="headerlink" title="使用 nohup 启动"></a>使用 nohup 启动</h1><p>nohup &#x2F;root&#x2F;run_loophole.sh &gt; &#x2F;root&#x2F;loophole.log 2&gt;&amp;1 &amp;</p> <p>exit 0<br>‘’’<br>‘chmod +x &#x2F;etc&#x2F;rc.local<br>‘<br> 重启验证<br> ‘’’<br> reboot</p> <h1 id="重启后查看日志"><a href="#重启后查看日志" class="headerlink" title="重启后查看日志"></a>重启后查看日志</h1><p> cat &#x2F;root&#x2F;loophole.log<br> ‘’’</p> </div> <footer class="article-footer"> </footer> </div> <nav id="article-nav"> <a href="/%E6%88%91%E7%9A%84%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E4%BA%8C%E7%BB%B4%E7%A0%81.htm" id="article-nav-newer" class="article-nav-link-wrap"> <strong class="article-nav-caption">前一篇</strong> <div class="article-nav-title"> 我的微信收款二维码.谢谢善良好心人士的捐赠 </div> </a> <a href="/%E4%BB%8E%E5%8E%BB%E5%B9%B4%E7%9A%84%E8%BF%99%E5%A4%A9%E5%88%B0%E7%8E%B0%E5%9C%A8%EF%BC%8C%E8%BF%99%E4%B9%88%E5%A4%9A%E4%B8%8D%E5%B9%B8%E5%8F%91%E7%94%9F%E5%9C%A8%E6%88%91%E8%BA%AB%E4%B8%8A%EF%BC%8C%E8%84%9A%E8%B6%BE%E5%A4%B4%E5%8F%97%E4%BC%A4%E5%88%B0%E7%8E%B0%E5%9C%A8%E4%B8%80%E5%B9%B4%E4%BA%86%EF%BC%8C%E5%93%92%E5%93%92%E7%A6%BB%E5%BC%80%E4%BA%86%E6%88%91%EF%BC%8C%E6%88%91%E5%BF%83%E6%8E%89%E5%80%92%E8%B0%B7%E5%BA%95%EF%BC%8C%E5%86%8D%E6%89%BE%E4%B8%8D%E5%88%B0%E6%B4%BB%E4%B8%8B%E5%8E%BB%E7%9A%84%E6%84%8F%E4%B9%89.htm" id="article-nav-older" class="article-nav-link-wrap"> <strong class="article-nav-caption">后一篇</strong> <div class="article-nav-title">从去年的这天到现在，这么多不幸发生在我身上，脚趾头受伤到现在一年了，哒哒离开了我，我心掉倒谷底，再找不到活下去的意义</div> </a> </nav> </article> </section> </div> <footer id="footer"> <a href="https://hexo.io/" target="_blank">Hexo</a></footer> </div> <nav id="mobile-nav"> </nav> </div> </body></html>